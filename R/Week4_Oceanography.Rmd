---
title: "Matt Oliver Oceanography with Rasters"
output: rmarkdown::github_document
---
  
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Essential Skills: The For Loop with Paste0

Last week we covered the for loop which is an essential programming skill. We also touched on the paste0 function, but this is incredibly useful and should be expanded upon. paste0() is the sister function of paste(), who's cousin is sprintf() . It depends on preference, but most coders I know gravitate towards paste0(). Let's check out all 3. 

``` {r}
# Paste Example 1 - default sep (aka separation) is space
paste("file", "number", "32")

# Paste Example 2 - set sep to "_"
paste("file", "number", "32", sep = "_")

# Paste0 Example 1 - 0 for 0 separating characters
paste0("file", "number", "32")

# sprintf example 1
sprintf("%s %s %s", "file", "number", "32")

# sprintf example 2
person <-"Grover"
action <-"flying"
message(sprintf("On %s I realized %s was...\n%s by the street", Sys.Date(), person, action))

# Notice that paste is limiting because the separating character is not always present between
# each string you're concatenating

# Let's use paste0 here
fileList <- c('filename1', 'filename2', 'filename3', 'filename4')
dateFolder <- c('0813', '0814', '0815', '0816')
homeDir <- "~/Documents/"
pathList <- list()

for (i in 1:length(fileList)){
  print(i)
  tempString <- paste0(homeDir, dateFolder[i], '/', fileList[i])
  pathList[i] <- tempString
}

pathList

pathList[[1]]


# Now let's rewrite using sprintf
fileList <- c('filename1', 'filename2', 'filename3', 'filename4')
dateFolder <- c('0813', '0814', '0815', '0816')
homeDir <- "~/Documents/"
pathList <- list()

pathList <- sprintf("%s%s/%s", homeDir, dateFolder, fileList)

pathList

pathList[[1]]

#sprintf is a very useful and quick function for combining various strings into longer strings
#but paste0 allows you a little more freedom and is slightly more intuitive

```

Debug and fix the following code:

``` {r, echo=FALSE}
# Let's use paste0 here
fileList <- c('sstData20190912', 'sstData20190913', 'sstData20190914', 'sstData20190915')
dateFolder <- seq(0912, 0915, 1)
homeDir <- "~/Documents/"
pathList <- list()

for (i in fileList){
  print(i)
  tempString <- paste0(homeDir, dateFolder[i], '/', i)
  pathList[i] <- tempString
}

pathList

pathList[[1]]
```

The final `pathList[[1]]` should look like this...

`"~/Documents/0912/sstData20190912"`


## Rasters with Oceanography

# Plot GOES-R Rolling 1 day data

``` {r, message=FALSE}
library(maptools) # also loads sp package
library(ncdf4)
library(raster)
library(rasterVis)
library(RColorBrewer)
ncFile <- nc_open("~/Downloads/GOES_R_ROLLING_1DAY_20190814.nc")
sstGoes <- ncvar_get(ncFile, varid = "sst")
sstRast <- raster(sstGoes)

image(sstRast)

# netcdf stores data backwards, so to convert it to raster we need to transpose it
sstRast <- t(sstRast)

image(sstRast)

# now we see that the data is just upside down, so we use the flip() function
sstRast <- flip(sstRast, 2)

image(sstRast)

sstRast

# notice that the extent and crs information are wrong/not included so let's fix this

lat = ncvar_get(ncFile, "latitude")
lon = ncvar_get(ncFile, "longitude")

extent(sstRast) = c(min(lon), max(lon), min(lat), max(lat))
crs(sstRast) = "+proj=longlat +datum=WGS84 +no_defs "
sstRast
image(sstRast)


library(rasterVis)
levelplot(sstRast)

usa <- getData('GADM', country = 'USA', level = 1)

plt <- levelplot(sstRast, margin=F, par.settings=BuRdTheme,
       main="GOES-R Rolling SST 08/14")
plt + layer(sp.polygons(usa, col='black',fill='grey', lwd=0.4))

# Now let's do the same with geotiff
tifFile = "~/Downloads/GOES_R_ROLLING_1DAY_20190814.tif"
sstRast = raster(tifFile)

image(sstRast)

data(wrld_simpl)
plt <- levelplot(sstRast, margin=F, par.settings=BuRdTheme,
       main="GOES-R Rolling SST 08/14")
plt + layer(sp.polygons(wrld_simpl, col='black',fill='grey', lwd=0.4))
```


Plot up chlorophyll vs temperature
pull in anomaly data
buoy validation experiment https://www.ndbc.noaa.gov/station_page.php?station=44009&uom=E&tz=STN
